# 测试问题设计说明

## 🎯 问题设计原则

### ✅ 好问题的特征
1. **明确性**：问题指向清晰，不产生歧义
2. **可验证性**：答案可以从 PDF 中直接验证
3. **覆盖性**：测试不同类型的检索能力
4. **难度分层**：从简单到复杂，测试系统边界

### ❌ 原问题的问题分析

#### 问题1：❌ "龙子湖校区有几个食堂？"
**问题**：
- **歧义1**：民族风味算不算独立食堂？（实际是二号餐厅的一个窗口）
- **歧义2**："食堂"的定义不清（是指建筑物还是所有餐饮场所？）
- **数据问题**：PDF 中可能没有明确说"共有X个食堂"

**改进版本**：
- ✅ "一号餐厅有哪些窗口或档口？"（具体明确）
- ✅ "二号餐厅一楼有哪些档口？"（可枚举验证）

---

#### 问题2：❌ "哪个食堂最便宜？"
**问题**：
- **统计问题**：最便宜的定义不明确
  - 是看最低价？平均价？中位数？
  - 是看单品？还是套餐？
- **计算复杂**：需要聚合所有档口的所有菜品
- **答案主观**：不同人对"便宜"的理解不同

**改进版本**：
- ✅ "2元可以买到哪些食品？"（精确价格查询）
- ✅ "一号餐厅最便宜的粥是多少钱？"（明确范围+类别）
- ✅ "5元以下有什么早餐选择？"（价格范围+场景）

---

#### 问题3：❌ "哪个食堂的菜品种类最多？"
**问题**：
- **统计困难**：需要计数所有菜品
- **定义模糊**："种类"的粒度不清（是按档口？按菜系？）
- **数据限制**：PDF 可能没有完整的菜品列表

**改进版本**：
- ✅ "哪个档口的包子种类最多？"（具体类别，可数）
- ✅ "哪些窗口提供包子类食品？"（按类别聚合）

---

## 📊 新问题分类体系

### 1️⃣ 实体查找类（测试精确匹配）
```
目的：测试能否准确找到具体实体
难度：⭐⭐

示例：
- "一号餐厅有哪些窗口或档口？"
- "二号餐厅一楼有哪些档口？"
- "哪些窗口提供包子类食品？"

评判标准：
✅ 列举完整
✅ 无遗漏
✅ 无错误添加
```

### 2️⃣ 价格查询类（测试数值过滤）
```
目的：测试能否按价格筛选和排序
难度：⭐⭐⭐

示例：
- "2元可以买到哪些食品？"
- "5元以下有什么早餐选择？"
- "一号餐厅最便宜的粥是多少钱？"

评判标准：
✅ 价格准确
✅ 筛选正确
✅ 不遗漏符合条件的项
```

### 3️⃣ 窗口定位类（测试关系查询）
```
目的：测试实体间的关系理解
难度：⭐⭐

示例：
- "我爱我粥在哪个餐厅的哪个窗口？"
- "天津包子档口在几号窗口？"
- "二号餐厅10号窗口是什么档口？"

评判标准：
✅ 餐厅正确
✅ 窗口号正确
✅ 档口名正确
```

### 4️⃣ 菜品推荐类（测试语义理解）
```
目的：测试自然语言需求理解
难度：⭐⭐⭐⭐

示例：
- "早餐想喝粥，有哪些选择？"
- "哪里可以买到手工水饺？"
- "想吃面条，有哪些窗口？"

评判标准：
✅ 理解用户意图
✅ 推荐合理
✅ 提供必要信息（价格、位置）
```

### 5️⃣ 组合查询类（测试复杂推理）
```
目的：测试多条件组合查询
难度：⭐⭐⭐⭐⭐

示例：
- "一号餐厅有哪些2元的粥？"（餐厅+价格+类别）
- "二号餐厅哪些窗口有1.5元的食品？"（餐厅+价格）
- "我爱我粥都卖什么？价格是多少？"（菜单展示）

评判标准：
✅ 所有条件都满足
✅ 信息完整
✅ 结构化呈现
```

### 6️⃣ 对比查询类（测试聚合能力）
```
目的：测试系统的边界和聚合能力
难度：⭐⭐⭐⭐⭐

示例：
- "天津包子和香港九龙包，哪个更便宜？"
- "一号餐厅和二号餐厅，哪个档口更多？"

评判标准：
✅ 能否获取对比数据
✅ 能否做出比较
✅ 结论是否准确
```

---

## 🔍 问题设计检查清单

设计每个问题时，检查：

- [ ] **是否有明确答案**？（能从 PDF 验证）
- [ ] **是否无歧义**？（只有一种理解方式）
- [ ] **是否测试特定能力**？（不是泛泛而谈）
- [ ] **难度是否合适**？（不要太简单或太难）
- [ ] **是否公平**？（向量和 BM25 都有机会表现）

---

## 📈 如何评估测试结果

### 定量指标
1. **准确率**：答案是否正确
2. **完整率**：是否遗漏信息
3. **响应时间**：查询速度

### 定性指标
1. **答案相关性**：是否回答了问题
2. **信息完整性**：是否提供足够细节
3. **表达清晰度**：答案是否易懂

### 对比维度
```
向量检索 vs 混合检索：

预期差异：
- 向量检索：语义理解好，适合模糊查询
- 混合检索：精确匹配好，适合实体查找

测试目标：
✅ 找出各自优势场景
✅ 发现性能差异
✅ 为优化提供依据
```

---

## 💡 问题设计建议

### 基于实际数据
1. **先读 PDF**：了解数据结构
2. **提取实体**：餐厅、窗口、食品、价格
3. **设计关系**：实体之间的连接
4. **构造问题**：覆盖不同查询模式

### 避免的问题类型
❌ 需要外部知识的问题（"哪个食堂环境好"）
❌ 主观评价问题（"学生推荐哪个食堂"）
❌ PDF中没有的信息（"营业时间"、"支付方式"）
❌ 需要复杂计算的问题（"平均价格"、"菜品种类排名"）

### 推荐的问题类型
✅ 精确查询（"19号窗口是什么？"）
✅ 范围查询（"2-5元的食品"）
✅ 分类查询（"所有粥类"）
✅ 关系查询（"XX在哪个餐厅？"）

---

## 🎯 实际使用示例

### 运行测试
```powershell
# 测试前5个问题（快速验证）
python test_ab_simple.py 5

# 测试所有问题（完整评估）
python test_ab_simple.py
```

### 查看结果
```powershell
# 打开测试报告
notepad ab_test_report_*.txt

# 查看 JSON 数据
code ab_test_results_*.json
```

### 分析对比
```
查看每个问题：
1. 两种方法的答案是否都正确？
2. 哪种方法更快？
3. 哪种方法答案更完整？
4. 是否有明显优劣？

总结规律：
- 向量检索擅长：语义模糊查询
- 混合检索擅长：精确实体查找
```

---

## 🔄 持续改进

### 迭代优化
1. **第一轮测试**：发现问题
2. **调整问题**：修复歧义
3. **第二轮测试**：验证改进
4. **优化系统**：调参数

### 问题池管理
```python
# 可以分类管理问题
EASY_QUESTIONS = [...]    # 简单问题（实体查找）
MEDIUM_QUESTIONS = [...]  # 中等问题（价格查询）
HARD_QUESTIONS = [...]    # 困难问题（复杂推理）

# 根据需要组合测试
```

---

**总结**：好的测试问题 = 明确 + 可验证 + 有针对性 + 无歧义

现在的问题集已经重新设计，更符合实际数据和测试目标！

