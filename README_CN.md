# ç»“æ„åŒ–æ•°æ®çš„ä¸Šä¸‹æ–‡æ£€ç´¢ï¼šå¯å¤ç°å®éªŒ

**[English](README.md) | [ç®€ä½“ä¸­æ–‡](README_CN.md)**

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Reproducible](https://img.shields.io/badge/reproducible-yes-green.svg)](https://github.com/roclee2692/contextual-retrieval-by-anthropic)

> **æ ¸å¿ƒå‘ç°**ï¼šåœ¨å¤ç°äº† Anthropic çš„ Contextual Retrieval ç®—æ³•åï¼Œæˆ‘ä»¬å¼•å…¥äº†**å‚ç›´é¢†åŸŸï¼ˆé˜²æ´ªï¼‰çŸ¥è¯†å›¾è°±**è¿›è¡Œå¯¹æ¯”å®éªŒã€‚å‘ç° CR åœ¨ç»“æ„åŒ–æ•°æ®ä¸Šå­˜åœ¨â€œåŒåˆƒå‰‘â€æ•ˆåº”ï¼Œè€ŒçŸ¥è¯†å›¾è°±èƒ½æ˜¾è‘—å¼¥è¡¥å…¶åœ¨é€»è¾‘æ¨ç†ä¸Šçš„çŸ­æ¿ã€‚

---

## ğŸ¯ è¿™æ˜¯ä»€ä¹ˆ

æœ¬é¡¹ç›®åŸºäºä¸­æ–‡æ•°æ®é›†å¤ç°äº† [Anthropic çš„ Contextual Retrieval è®ºæ–‡](https://www.anthropic.com/news/contextual-retrieval)ï¼Œå¹¶é€šè¿‡ä¸¤ä¸ªé˜¶æ®µçš„å¯¹æ¯”å®éªŒéªŒè¯å…¶æœ‰æ•ˆæ€§ï¼š

| å®éªŒé˜¶æ®µ | æ–¹æ³• | æ ¸å¿ƒæŠ€æœ¯ | é€‚ç”¨æ•°æ® |
|---|---|---|---|
| **Phase 1** | Baseline RAG vs CR | å‘é‡æ£€ç´¢ + LLM ä¸Šä¸‹æ–‡å¢å¼º | é£Ÿå ‚èœå•ï¼ˆç»“æ„åŒ–åˆ—è¡¨ï¼‰ |
| **Phase 2ï¼ˆæ–°ï¼‰** | **Knowledge Graph** | **å›¾è°±æ¨ç† (LlamaIndex KG)** | **é˜²æ´ªé¢„æ¡ˆï¼ˆéç»“æ„åŒ–æ–‡æ¡£ï¼‰** |

---

## ğŸ“Š Phase 1: é£Ÿå ‚å®éªŒç»“æœ

> ç»“è®ºï¼šCR åœ¨è§£å†³æ­§ä¹‰ï¼ˆå¦‚â€œå¤©æ´¥åŒ…å­â€æ˜¯åº—åè¿˜æ˜¯èœåï¼‰ä¸Šæå…¶æœ‰æ•ˆï¼ˆä»0%æå‡è‡³100%å‡†ç¡®ç‡ï¼‰ï¼Œä½†åœ¨å¯†é›†åˆ—è¡¨æ•°æ®çš„ç»†èŠ‚æ£€ç´¢ä¸Šåè€Œå¯¼è‡´ä¿¡æ¯ä¸¢å¤±ã€‚

| æŒ‡æ ‡ | å®éªŒä¸€(Baseline) | å®éªŒäºŒ(CR) | å®éªŒä¸‰(ç»“å·´+KG) |
|---|---|---|---|
| **å¹³å‡å“åº”æ—¶é—´** | 12.79ç§’ | 13.64ç§’ | **10.13ç§’** âš¡ |
| **æ··åˆæ£€ç´¢åŠ é€Ÿæ¯”** | 9.9% | 8.5% | **19.9%** |
| **ä»·æ ¼ç±»æŸ¥è¯¢å‡†ç¡®ç‡** | 75% | **100%** âœ… | 100% |

---

## ğŸ†• Phase 2: é˜²æ´ªä¸çŸ¥è¯†å›¾è°±å®éªŒï¼ˆæ–°å¢ï¼‰

åœ¨ Phase 1 çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬æ‰©å±•äº† **é˜²æ´ªåº”æ€¥é¢„æ¡ˆ** æ•°æ®çš„ç ”ç©¶ï¼Œæ„å»ºäº†åŸºäº Graph çš„æ·±å±‚æ£€ç´¢ç³»ç»Ÿã€‚

*è¯¦ç»†å¯¹æ¯”æŠ¥å‘Šè§ `results/flood_comparison_report.md`*

### æ ¸å¿ƒæ”¹è¿›
1.  **çŸ¥è¯†å›¾è°± (KG)**ï¼š
    *   æ„å»ºäº†åŒ…å« **600+ å®ä½“** çš„é˜²æ´ªçŸ¥è¯†ç½‘ç»œã€‚
    *   è§£å†³äº†çº¯å‘é‡æ£€ç´¢æ— æ³•å›ç­”çš„**é€»è¾‘é“¾é—®é¢˜**ã€‚
    *   *ä¾‹å­*ï¼šç”¨æˆ·é—®â€œè°è´Ÿè´£æ°´åº“æ¼«åé¢„è­¦ï¼Ÿâ€ï¼ŒKG èƒ½æ²¿ç€ `æŒ‡æŒ¥éƒ¨ -> èŒè´£ -> é¢„è­¦è§¦å‘` çš„è·¯å¾„æ‰¾åˆ°å‡†ç¡®ç­”æ¡ˆã€‚

2.  **åŒå®éªŒç¯å¢ƒ**ï¼š
    *   é¡¹ç›®ç°åœ¨æ”¯æŒé€šè¿‡ `.env` åˆ‡æ¢â€œé£Ÿå ‚â€å’Œâ€œé˜²æ´ªâ€ä¸¤ç§å®éªŒåœºæ™¯ã€‚

---

## ğŸ”„ ç³»ç»Ÿæµç¨‹å›¾ (System Pipeline)

```mermaid
graph LR
    A[PDF æ•°æ®] --> B[æ–‡æœ¬åˆ‡ç‰‡]
    B --> C{å¯ç”¨ CR?}
    C -->|æ˜¯| D[LLM ç”Ÿæˆä¸Šä¸‹æ–‡]
    C -->|å¦| E[åŸå§‹åˆ‡ç‰‡]
    D --> F[æ‹¼æ¥ä¸Šä¸‹æ–‡ + åŸæ–‡]
    E --> G[Embedding å‘é‡åŒ–]
    F --> G
    G --> H[å‘é‡æ•°æ®åº“ ChromaDB]
    
    subgraph æ··åˆæ£€ç´¢
    B --> I{å¯ç”¨ç»“å·´?}
    I -->|æ˜¯| J["ä¸­æ–‡åˆ†è¯<br/>(BM25)"]
    I -->|å¦| K[é»˜è®¤åˆ†è¯]
    J --> L[BM25 ç´¢å¼•]
    K --> L
    end

    subgraph Phase 2: çŸ¥è¯†å›¾è°±
    B --> M[å®ä½“æŠ½å–]
    M --> N[å›¾è°±æ„å»º (Graph Store)]
    N --> O[å›¾è°±æ¨ç†æŸ¥è¯¢]
    end
    
    H -.-> P[æœ€ç»ˆæ··åˆæ£€ç´¢]
    L -.-> P
    O -.-> P
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå®‰è£…
```bash
git clone https://github.com/roclee2692/contextual-retrieval-by-anthropic.git
cd contextual-retrieval-by-anthropic
pip install -r requirements.txt
```

### 2. è¿è¡Œ Phase 1: é£Ÿå ‚å®éªŒ (Original)
```bash
# åˆ‡æ¢é…ç½®
Copy-Item .env.canteen .env

# æ„å»ºæ•°æ®åº“ä¸è¿è¡Œæµ‹è¯•
python scripts/create_save_db.py
python scripts/test_ab_simple.py
```

### 3. è¿è¡Œ Phase 2: é˜²æ´ªå®éªŒ (New KG)
```bash
# åˆ‡æ¢é…ç½®
Copy-Item .env.flood .env

# æ„å»ºçŸ¥è¯†å›¾è°±ï¼ˆéœ€è¿æ¥ Ollamaï¼‰
python scripts/create_knowledge_graph.py

# éªŒè¯å›¾è°±æ£€ç´¢
python scripts/test_kg_retrieval.py
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
contextual-retrieval-by-anthropic/
â”œâ”€â”€ .env                    # å½“å‰ç”Ÿæ•ˆé…ç½®
â”œâ”€â”€ .env.canteen            # é£Ÿå ‚å®éªŒé…ç½®
â”œâ”€â”€ .env.flood              # é˜²æ´ªå®éªŒé…ç½®
â”œâ”€â”€ data/                   # æ•°æ®é›†
â”œâ”€â”€ src/                    # æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ contextual_retrieval/
â”‚   â”œâ”€â”€ db/                 # å‘é‡/å›¾è°±æ•°æ®åº“å­˜å‚¨
â”‚   â””â”€â”€ tools/
â””â”€â”€ results/                # å®éªŒç»“æœæŠ¥å‘Š
```

---

## ğŸ“§ è”ç³»æ–¹å¼
**ä½œè€…**ï¼šroclee2692  
**GitHub**ï¼š[@roclee2692](https://github.com/roclee2692)

**å¦‚æœæœ¬é¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª â­ï¸ Starï¼**
