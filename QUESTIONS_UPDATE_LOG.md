# 测试问题已优化 - 更新说明

## ✅ 已完成的改进

### 1. **修复了原有问题的歧义**

#### 原问题 ❌
```
1. "龙子湖校区有几个食堂？"
   → 民族风味算不算食堂？有歧义

2. "哪个食堂最便宜？"
   → 最便宜的定义不清（平均价？最低价？）

3. "哪个食堂的菜品种类最多？"
   → 需要复杂统计，答案主观
```

#### 新问题 ✅
```
1. "一号餐厅有哪些窗口或档口？"
   → 明确具体，可枚举验证

2. "2元可以买到哪些食品？"
   → 精确价格查询

3. "哪个档口的包子种类最多？"
   → 范围明确，可数
```

---

### 2. **新问题集结构（共 21 个问题）**

#### 📋 分类统计

| 类别 | 数量 | 难度 | 目的 |
|------|------|------|------|
| **实体查找** | 3个 | ⭐⭐ | 测试精确匹配 |
| **价格查询** | 3个 | ⭐⭐⭐ | 测试数值过滤 |
| **窗口定位** | 3个 | ⭐⭐ | 测试关系查询 |
| **菜品推荐** | 3个 | ⭐⭐⭐⭐ | 测试语义理解 |
| **特色查询** | 3个 | ⭐⭐⭐ | 测试上下文 |
| **组合查询** | 3个 | ⭐⭐⭐⭐⭐ | 测试复杂推理 |
| **对比查询** | 2个 | ⭐⭐⭐⭐⭐ | 测试边界 |

---

### 3. **问题示例详解**

#### 类型1：实体查找（简单明确）
```python
"一号餐厅有哪些窗口或档口？"
```
**预期答案**：
```
一号餐厅有以下窗口：
- 19号我爱我粥
- 17号酸辣拌
- 22号闫阿婆掉渣饼
- 23号烤盘饭
... (列举所有窗口)
```

**测试点**：
✅ 能否完整检索
✅ 能否按餐厅筛选
✅ 能否列举实体

---

#### 类型2：价格查询（数值过滤）
```python
"2元可以买到哪些食品？"
```
**预期答案**：
```
2元可以购买：
- 小米南瓜粥（19号我爱我粥）
- 清火绿豆粥（19号我爱我粥）
- 招牌鲜肉包（21号天津包子）
...
```

**测试点**：
✅ 能否精确匹配价格
✅ 能否聚合不同窗口的同价食品
✅ 能否提供位置信息

---

#### 类型3：窗口定位（关系查询）
```python
"我爱我粥在哪个餐厅的哪个窗口？"
```
**预期答案**：
```
我爱我粥在一号餐厅的19号窗口。
```

**测试点**：
✅ 能否理解档口名称
✅ 能否找到归属关系
✅ 答案是否精确

---

#### 类型4：菜品推荐（语义理解）
```python
"早餐想喝粥，有哪些选择？"
```
**预期答案**：
```
早餐粥类推荐：
- 小米南瓜粥（2元，19号我爱我粥）
- 清火绿豆粥（2元，19号我爱我粥）
- 紫薯黑米粥（2元，19号我爱我粥）
...
```

**测试点**：
✅ 能否理解"早餐"场景
✅ 能否识别"粥"类别
✅ 能否提供价格和位置

---

#### 类型5：组合查询（复杂推理）
```python
"一号餐厅有哪些2元的粥？"
```
**预期答案**：
```
一号餐厅2元的粥有：
- 小米南瓜粥（19号我爱我粥）
- 清火绿豆粥（19号我爱我粥）
- 紫薯黑米粥（19号我爱我粥）
```

**测试点**：
✅ 能否同时过滤：餐厅+价格+类别
✅ 能否提供完整信息
✅ 混合检索优势

---

#### 类型6：对比查询（测试边界）
```python
"天津包子和香港九龙包，哪个更便宜？"
```
**预期答案**：
```
天津包子：1.5元起（三鲜胡萝卜包等）
香港九龙包：2元起
天津包子更便宜。
```

**测试点**：
✅ 能否找到两个实体
✅ 能否提取价格
✅ 能否做比较

---

## 🎯 如何使用新问题集

### 快速测试（推荐）
```powershell
# 测试前5个问题（覆盖主要类型）
python test_ab_simple.py 5
```

### 标准测试
```powershell
# 测试前10个问题
python test_ab_simple.py 10
```

### 完整测试
```powershell
# 测试所有21个问题
python test_ab_simple.py
```

---

## 📊 预期测试效果

### 向量检索 vs 混合检索

**向量检索擅长**：
- ✅ 语义相近查询（"早餐想喝粥"）
- ✅ 模糊匹配（"哪里可以吃面"）
- ❌ 精确实体查找可能不如混合

**混合检索擅长**：
- ✅ 精确实体查找（"19号窗口"）
- ✅ 关键词匹配（"2元"、"包子"）
- ✅ 组合条件查询
- ❌ 可能在语义理解上稍弱

**测试目标**：
找出各自优势，为后续优化提供依据

---

## 📝 结果分析指南

### 看什么？

1. **准确性**：答案是否正确？
2. **完整性**：是否遗漏信息？
3. **速度**：哪个更快？
4. **优势场景**：各自擅长什么？

### 示例分析
```
问题："2元可以买到哪些食品？"

方法 A（向量）回答：
- 小米南瓜粥、清火绿豆粥...
- 耗时：3.2s
- 完整度：80%（可能遗漏部分）

方法 B（混合）回答：
- 小米南瓜粥、清火绿豆粥、招牌鲜肉包...
- 耗时：2.1s
- 完整度：95%（BM25 精确匹配"2元"）

结论：混合检索在价格查询上更优
```

---

## 🔄 持续优化建议

### 发现问题后
1. 查看测试报告：`ab_test_report_*.txt`
2. 分析失败案例
3. 调整问题或系统参数
4. 重新测试验证

### 自定义问题
```python
# 在 test_ab_simple.py 中修改 TEST_QUESTIONS
TEST_QUESTIONS = [
    "你的问题1",
    "你的问题2",
    ...
]
```

---

## ✅ 总结

### 改进要点
- ✅ 删除了所有歧义问题
- ✅ 基于实际PDF数据设计
- ✅ 覆盖6种查询类型
- ✅ 难度分层（简单→困难）
- ✅ 每个问题都可验证

### 立即行动
```powershell
# 运行优化后的测试
python test_ab_simple.py 5

# 查看结果
notepad ab_test_report_*.txt
```

**新问题集更科学、更全面、更能测试系统真实能力！** 🎉

