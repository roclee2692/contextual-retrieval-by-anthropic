# Phase 2: 完整三组实验对比分析

**测试时间**: 2026-01-23 23:11:36

## 实验配置

| 实验组 | 说明 | 数据来源 |
|--------|------|----------|
| **Baseline** | 原始文档直接检索（向量+BM25） | 临时构建，无LLM增强 |
| **CR Enhanced** | 上下文增强检索 | 预构建数据库，含LLM生成的上下文 |
| **Knowledge Graph** | 知识图谱推理检索 | 预构建KG，三元组+实体关系 |

## 测试问题分类

| 类型 | 数量 | 说明 |
|------|------|------|
| 简单事实 | 1 | - |
| 枚举列表 | 2 | - |
| 规则描述 | 1 | - |
| 流程说明 | 1 | - |
| 条件判断 | 1 | - |
| 实体查询 | 1 | - |
| 多跳推理 | 1 | - |

## 逐题详细对比

### Q1: 杨家横水库的汛限水位是多少？

**类型**: 简单事实 | **分类**: 数值查询

| 实验 | Top-1 得分 | 耗时(s) | Top-1 预览 |
|------|-----------|---------|------------|
| Baseline | 0.752 | 0.04 | 2、雨前水位低于汛限水位，预计雨后库水位也不超过汛限水位，
 全部拦蓄，不启闸。
 3、雨前水位达汛限水位 298.50m，次降水量276.8mm,次净雨量
 ... |
| CR_Enhanced | 0.611 | 0.12 | Flood control procedures and indicators for Yangjiaheng Reservoir.最高水位的洪水），要采取临时... |
| KG | 1000.000 | 23.74 | 6 29 1836
 2014～
 201521 10 9 3 15 11 16 17 7 18 15 5 147
 31平均 262 217 103 37 2... |

### Q2: 防洪预案中的应急预案等级有哪些？

**类型**: 枚举列表 | **分类**: 分级查询

| 实验 | Top-1 得分 | 耗时(s) | Top-1 预览 |
|------|-----------|---------|------------|
| Baseline | 0.694 | 0.04 | 4、预警级 别及发布
 （1）对应突发事件分级和 溃坝事件发生的可能性，预警级 别也划
 分为四级，依次用 红色、橙色、黄色和蓝色表示。预警级 别划分标准。
 ... |
| CR_Enhanced | 0.512 | 0.02 | 信息包
 括预警级别、出险水库的地 点、出险时间、 可能影响范围、警示事项、
 应采取的措施和发 布机关等。预警 信息的发布、调整和解除可通过广
 播、电视、通... |
| KG | 1000.000 | 3.24 | （1）坝面垂直位移和水平位移观测。大坝垂直位移和水平位移
 基点置于大坝左右两端不产生变形的山体基岩上，各布置一组，共两
 组，位移观测标点共布置了3个断面，为... |

### Q3: 堤防巡查的标准是什么？

**类型**: 规则描述 | **分类**: 标准规范

| 实验 | Top-1 得分 | 耗时(s) | Top-1 预览 |
|------|-----------|---------|------------|
| Baseline | 0.571 | 0.03 | 135
 136水行政管理流程 图
 行政执法巡查 日常管理
 行政执法 日常巡查
 巡查频次为每日至少一次。巡查范围为水库大坝、放水洞、溢洪闸、围网工程（沿水... |
| CR_Enhanced | 0.413 | 0.02 | 水文监测和测量设施、监控设备、指示牌警示牌、围网等设施的行为；
 4.向库区内排放污水、废液，倾倒工业废渣、生活、建筑垃圾等废弃物；
 5.在坝堤或交通桥行驶超... |
| KG | 1000.000 | 2.88 | 38m，千年一遇 校核，最高库水位304.91m。
 根据杨家横水库除险加固工程 初步设计，结合水库除险加固后的
 实际运用情况， 经计算分析，水库工程达到千年... |

### Q4: 汛期调度的规则是什么？

**类型**: 流程说明 | **分类**: 规则流程

| 实验 | Top-1 得分 | 耗时(s) | Top-1 预览 |
|------|-----------|---------|------------|
| Baseline | 0.685 | 0.03 | 783.11526　　1.21
 198926417890　　　1042032　　　282.167.31287.083.31　　　　　
 19901127.
 ... |
| CR_Enhanced | 0.540 | 0.02 | Numerical data tables representing measurements or observations.2001631.3556440.... |
| KG | 1000.000 | 2.77 | 4%
 集中在汛期6～9四个月，呈现出春旱、夏涝、晚秋又旱的规律。
 202.2.5水位、库容、水面面积、泄量曲线
 表2-3水库水位、库容、面积、泄量关系表
... |

### Q5: 防洪抢险有哪些措施？

**类型**: 枚举列表 | **分类**: 措施清单

| 实验 | Top-1 得分 | 耗时(s) | Top-1 预览 |
|------|-----------|---------|------------|
| Baseline | 0.673 | 0.03 | 2.2应急抢险
 当发生破坏性地震等应急情况下，地 震气象部门要加强对 灾害性
 天气的监测和预报，提高调度的 科学性和预见性，根据不同险情制定
 相应的抢护措... |
| CR_Enhanced | 0.538 | 0.02 | 抢险队伍上坝防守，加固险工。
 513.7.3超标准洪水应急措施安排
 超标准洪水指超过水库现状防洪标准（千年一遇）的洪水，当
 发生超标准洪水时，本着“防重于... |
| KG | 1000.000 | 2.79 | ...................... 38
 5.1 抢险调度................................................ |

### Q6: 水位超过多少需要启动预案？

**类型**: 条件判断 | **分类**: 触发条件

| 实验 | Top-1 得分 | 耗时(s) | Top-1 预览 |
|------|-----------|---------|------------|
| Baseline | 0.570 | 0.03 | (3) 泄水建筑物及闸门的振动情况，坝基其他建 筑物基础、下游
 河床及岸坡、尾水渠以及其他建 筑物的冲刷或淤积情况。
 (4) 溢洪道：进水段有无坍塌、崩岸、... |
| CR_Enhanced | 0.427 | 0.02 | Monitoring procedures for reservoir water levels and engineering personnel arran... |
| KG | 1000.000 | 3.59 | 当雨前水位已达到298.50m，次降水量超过525.9mm,日净雨超
 过428.9mm，闸门全开畅泄，最高洪水位高于允许最高水位304.80
 m。此时按抢险... |

### Q7: 谁负责防洪指挥调度？

**类型**: 实体查询 | **分类**: 责任人查询

| 实验 | Top-1 得分 | 耗时(s) | Top-1 预览 |
|------|-----------|---------|------------|
| Baseline | 0.604 | 0.04 | 783.11526　　1.21
 198926417890　　　1042032　　　282.167.31287.083.31　　　　　
 19901127.
 ... |
| CR_Enhanced | 0.455 | 0.02 | 2001631.3556440.5515515　73028270295954286.566.16298.88.5200　　10.4
 2002419294165... |
| KG | 1000.000 | 2.63 | 5.2.2 调度计划
 防洪调度计划编制 以济南市人民 政府防汛抗旱指挥部批 复的防洪调
 度规程为依据。内容 包括：
 5352
 （1）工作目标。
 （2）... |

### Q8: 水库大坝出现险情时应该联系谁？

**类型**: 多跳推理 | **分类**: 应急联系

| 实验 | Top-1 得分 | 耗时(s) | Top-1 预览 |
|------|-----------|---------|------------|
| Baseline | 0.624 | 0.04 | 贾鲁河防汛抗旱指挥部办公室接到出险报告后，及时 综合整治情
 况，根据险情大 小及危害程度分 别向省防汛抗旱指挥部正副指挥长
 报告，并提出相应处理 意见。
 ... |
| CR_Enhanced | 0.462 | 0.02 | Reporting procedures for flood control and disaster response at a reservoir.部位出险... |
| KG | 1000.000 | 4.66 | ...... 262
 11.5 工资福利及社会保障 ................................. 263
 11.6 费用收取........ |

## 性能统计

| 实验 | 平均耗时(s) | 平均得分 | 无结果数 |
|------|------------|----------|----------|
| Baseline | 0.04 | 0.647 | 0 |
| CR_Enhanced | 0.03 | 0.495 | 0 |
| KG | 5.79 | 1000.000 | 0 |

## 关键发现

### 1. **知识图谱得分异常高（1000.0）**
KG检索的得分为1000.0是因为使用了不同的评分机制（可能是内部相似度计算），**不能与Baseline/CR的0-1分数直接对比**。应该关注检索内容的相关性而非分数。

### 2. **Baseline表现出人意料地好**
- **平均得分0.647高于CR的0.495** - 这说明CR的上下文增强在这个数据集上**反而降低了检索准确性**
- Baseline耗时最快（0.04s），说明临时构建的索引效率很高
- 对于简单事实查询（Q1: 汛限水位），Baseline的Top-1直接命中关键信息

### 3. **CR增强未达预期**
- CR的平均得分反而**比Baseline低23.5%**（0.495 vs 0.647）
- 可能原因：
  - LLM生成的上下文描述（如"Flood control procedures..."）过于概括，**丢失了具体数值**
  - 防洪预案文档本身结构化较好，额外的上下文反而引入噪音
  - gemma2:2b生成的中文上下文质量不够高

### 4. **知识图谱检索内容问题**
虽然KG耗时最长（5.79s，是Baseline的145倍），但查看其检索内容发现：
- Q1（汛限水位）返回的是数据表而非明确答案
- Q2（应急等级）返回的是监测设施信息，**完全不相关**
- Q7（负责人）返回的是"费用收取"，**答非所问**

**KG在这个数据集上检索质量很差**，三元组抽取可能不够准确。

### 5. **测试问题的科学性评估**

#### ✅ 覆盖良好的问题类型：
- 数值查询（Q1）- 有明确答案，易于验证
- 枚举列表（Q2, Q5）- 可以评估召回完整性
- 规则描述（Q3, Q4）- 测试长文本理解

#### ⚠️ 存在的问题：
1. **缺少语义相似问题** - 没有测试同义词转换（如"汛限水位" vs "防洪控制水位"）
2. **缺少反事实问题** - 没有测试"常庄水库的汛限水位"（应该回答不是杨家横）
3. **多跳推理问题太少** - 只有Q8一题，需要增加（如"杨家横水库溢洪闸闸门损坏时应该通知谁"）
4. **缺少时间敏感问题** - 如"2010年除险加固后的防洪标准是多少"

## 结论与建议

### Phase 2 的核心结论：

1. **Baseline（直接检索）在防洪预案数据集上表现最好** - 说明这类文档结构化程度高，不需要复杂的语义增强

2. **CR上下文增强效果不佳** - gemma2:2b生成的上下文质量不足，建议：
   - 尝试更强的LLM（如qwen2:7b或本地部署的qwen2.5:14b）
   - 优化prompt，要求保留关键数值和专有名词
   - 检查生成的上下文是否保留了原文的关键信息

3. **知识图谱需要重新构建** - 当前KG的三元组抽取不够准确，建议：
   - 检查create_knowledge_graph.py的实体/关系抽取逻辑
   - 使用更适合中文的NER模型
   - 增加针对数值、日期、职位等关键信息的特殊处理

4. **测试问题需要扩充** - 当前8题不够全面，建议增加到20-30题，覆盖：
   - 语义相似变换
   - 反事实查询
   - 多跳推理（至少5题）
   - 时间序列问题
   - 数值计算问题

### 对比 Phase 1（食堂数据）：

Phase 1中CR明显优于Baseline（从案例可以看出），而Phase 2中CR反而更差。**这说明CR的效果高度依赖于数据集特性**：
- 非结构化文本（如食堂口碑评论）受益于上下文增强
- 结构化文档（如防洪预案）可能不需要或甚至被上下文干扰

